---
- name: Install yum-utils
  dnf:
    name: yum-utils
    state: present

- name: Install Dimension RPMs repo
  command: yum-config-manager --add-repo http://dimension-sh.github.io/dimension-rpms/dimension-rpms.repo
  args:
    creates: /etc/yum.repos.d/dimension-rpms.repo

- name: Set Powertools repo name for RedHat
  set_fact:
    powertools_repofile: CentOS-PowerTools.repo
  when: ansible_facts['os_family'] == "RedHat"

- name: Set Powertools repo name for Rocky
  set_fact:
    powertools_repofile: Rocky-PowerTools.repo
  when: ansible_facts['os_family'] == "Rocky"

- name: Check if PowerTools Repo exists
  stat:
    path: "/etc/yum.repos.d/{{ powertools_repofile }}"
  register: powertools_repo_file

- name: Enable PowerTools repo
  lineinfile:
    path: "/etc/yum.repos.d/{{ powertools_repofile }}"
    regexp: "^enabled="
    line: "enabled=1"
  when: powertools_repo_file.stat.exists

- name: Install epel-release Packages
  dnf:
    name: epel-release
    state: present
